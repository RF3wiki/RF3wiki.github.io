<!DOCTYPE html>
<html lang="zh-hant-tw">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Hello, world!</title>
    <style>
        button {
            margin: auto;
            padding: 1rem;
        }

        .btn-list {
            display: flex;
            flex-wrap: wrap;
            justify-content: flex-start;
            align-items: center;
        }

        .btn-list button {
            width: 10rem;
        }
    </style>
</head>

<body>
    <div class="btn-list">
        <div class="col"> <button value="farmNew" data-name="農具" class="btn">農具</button></div>
        <div class="col"> <button value="swordNew" data-name="單手劍" class="btn">單手劍</button></div>
        <div class="col"> <button value="hswordNew" data-name="雙手劍" class="btn">雙手劍</button></div>
        <div class="col"> <button value="dualwieldNew" data-name="雙劍" class="btn">雙劍</button></div>
        <div class="col"> <button value="spearNew" data-name="槍" class="btn">槍</button></div>
        <div class="col"> <button value="axeNew" data-name="斧" class="btn">斧</button></div>
        <div class="col"> <button value="hammerNew" data-name="錘" class="btn">錘</button></div>
        <div class="col"> <button value="staffNew" data-name="杖" class="btn">杖</button></div>
        <div class="col"> <button value="shieldNew" data-name="盾" class="btn">盾</button></div>
        <div class="col"> <button value="headNew" data-name="頭" class="btn">頭</button></div>
        <div class="col"> <button value="shoeNew" data-name="鞋" class="btn">鞋</button></div>
        <div class="col"> <button value="accNew" data-name="飾品" class="btn">飾品</button></div>
        <div class="col"> <button value="colNew" data-name="收集" class="btn">收集</button></div>
        <div class="col"> <button value="drugRCNew" data-name="藥學調合" class="btn">藥學調合</button></div>

    </div>

    <script type="module">
        import pan from '../其他CSV/json/料理/平底鍋料理.json' assert {type: 'json'}; //平底鍋料理
        import emptyHanded from '../其他CSV/json/料理/空手料理.json' assert {type: 'json'}; //空手料理
        import oven from '../其他CSV/json/料理/烤箱料理.json' assert {type: 'json'}; //烤箱料理
        import kitchenKnife from '../其他CSV/json/料理/菜刀料理.json' assert {type: 'json'}; //菜刀料理
        import steamer from '../其他CSV/json/料理/蒸籠料理.json' assert {type: 'json'}; //蒸籠料理
        import pot from '../其他CSV/json/料理/鍋子料理.json' assert {type: 'json'}; //鍋子料理
        import blender from '../其他CSV/json/料理/攪拌機料理.json' assert {type: 'json'}; //攪拌機料理
        console.log()
        // import farm from '../新增資料夾/JSON/農具.json' assert {type: 'json'}   //農具
        // import sword from '../新增資料夾/JSON/單手劍.json' assert {type: 'json'}   //單手劍
        // import hsword from '../新增資料夾/JSON/雙手劍.json' assert {type: 'json'}   //雙手劍
        // import dualwield from '../新增資料夾/JSON/雙劍.json' assert {type: 'json'}   //雙劍
        // import spear from '../新增資料夾/JSON/槍.json' assert {type: 'json'}  //槍
        // import axe from '../新增資料夾/JSON/斧.json' assert {type: 'json'}  //斧
        // import hammer from '../新增資料夾/JSON/錘.json' assert {type: 'json'}  //錘
        // import staff from '../新增資料夾/JSON/杖.json' assert {type: 'json'}  //杖
        // import shield from '../新增資料夾/JSON/盾.json' assert {type: 'json'}  //盾
        // import head from '../新增資料夾/JSON/頭.json' assert {type: 'json'}  //頭
        // import shoe from '../新增資料夾/JSON/鞋.json' assert {type: 'json'}  //鞋
        // import acc from '../新增資料夾/JSON/飾品.json' assert {type: 'json'}   //飾品
        // import col from '../新增資料夾/JSON/收集.json' assert {type: 'json'}   //收集
        // import drugRC from '../新增資料夾/JSON/藥學調合.json' assert {type: 'json'}   //收集

        const
            farmNew = [],
            swordNew = [],
            hswordNew = [],
            dualwieldNew = [],
            spearNew = [],
            axeNew = [],
            hammerNew = [],
            staffNew = [],
            shieldNew = [],
            headNew = [],
            shoeNew = [],
            accNew = [],
            colNew = [],
            drugRCNew = [];

        const
            panNew = [],
            emptyHandedNew = [],
            ovenNew = [],
            kitchenKnifeNew = [],
            steamerNew = [],
            potNew = [],
            blenderNew = [];

        console.log(pan.find(el => el.name == '天婦羅'));
        pan.forEach(item => {
            const existingItem = panNew.find(transformedItem => transformedItem.name === item.name);
            const formula = { skillLv: item.skillLv, formula: item.list };
            if (!existingItem) {
                panNew.push({
                    name: item.name,
                    checked: false,
                    list: [formula],
                    sp: item.sp
                });
            } else {
                existingItem.list.push(formula);
            }
        });
        console.log(pan);

        // getDrug(pan, panNew)
        // getDrug(emptyHanded, emptyHandedNew)
        // getDrug(oven, ovenNew)
        // getDrug(kitchenKnife, kitchenKnifeNew)
        // getDrug(steamer, steamerNew)
        // getDrug(pot, potNew)
        // getDrug(blender, blenderNew)

        const newJson = [];

        // getDrug(drugRC, drugRCNew);
        // getforEach(farm, farmNew);
        // getforEach(sword, swordNew);
        // getforEach(hsword, hswordNew);
        // getforEach(dualwield, dualwieldNew);
        // getforEach(spear, spearNew);
        // getforEach(axe, axeNew);
        // getforEach(hammer, hammerNew);
        // getforEach(staff, staffNew);
        // getforEach(shield, shieldNew);
        // getforEach(head, headNew);
        // getforEach(shoe, shoeNew);
        // getforEach(acc, accNew);
        // getforEach(col, colNew);

        function getforEach(obj, target) {
            obj.forEach(el => {
                let newItem = {
                    name: el.name,
                    jpName: el.jpName,
                    checked: false,
                    attr: el.attr ? el.attr : null,
                    atk: el.atk ? parseInt(el.atk) : null,
                    matk: el.matk ? parseInt(el.matk) : null,
                    def: el.def ? parseInt(el.def) : null,
                    mdef: el.mdef ? parseInt(el.mdef) : null,
                    sp: el.sp ? el.sp.split('，') : [],
                    se: el.se ? el.se : null,
                    notion: el.notion ? el.notion : null,
                    skillLv: el.skillLv ? parseInt(el.skillLv) : null,
                    item: [],
                    buy: parseInt(el.buy),
                    sell: parseInt(el.sell),
                    useRP: el.useRP ? parseInt(el.useRP) : null,
                    get: el.get ? el.get : null
                }
                removeNull(newItem)
                el.item1 != '' ? newItem.item.push(el.item1) : '';
                el.item2 != '' ? newItem.item.push(el.item2) : '';
                el.item3 != '' ? newItem.item.push(el.item3) : '';
                el.item4 != '' ? newItem.item.push(el.item4) : '';
                el.item5 != '' ? newItem.item.push(el.item5) : '';
                el.item6 != '' ? newItem.item.push(el.item6) : '';
                target.push(newItem);
            });
        }

        function getDrug(obj, target, fileName) {
            obj.forEach(el => {
                const existingItem = target.find(transformedItem => transformedItem.name === el.name);
                const formula = { skillLv: parseInt(el.skillLv), formula: [] };
                el.item1 != '' ? formula.formula.push(el.item1) : '';
                el.item2 != '' ? formula.formula.push(el.item2) : '';
                el.item3 != '' ? formula.formula.push(el.item3) : '';
                el.item4 != '' ? formula.formula.push(el.item4) : '';
                el.item5 != '' ? formula.formula.push(el.item5) : '';
                el.item6 != '' ? formula.formula.push(el.item6) : '';

                if (!existingItem) {
                    target.push({
                        name: el.name,
                        jpName: el.jpName,
                        checked: false,
                        list: [formula],
                        sp: el.sp ? el.sp.split('，') : [],
                        buy: parseInt(el.buy),
                        sell: parseInt(el.sell),
                        notion: el.notion
                    });
                } else {
                    existingItem.list.push(formula);
                }
            });
            target = obj;
        }

        function removeNull(target) {
            Object.keys(target).forEach(function (key) {
                if (target[key] === null) {
                    delete target[key];
                }
            });
        }

        function downloadFile(target, fileName) {
            const data = JSON.stringify(target);
            let blob = new Blob([data], {
                type: "application/json",
            });
            var href = URL.createObjectURL(blob);
            var link = document.createElement("a");
            document.body.appendChild(link);
            link.href = href;
            link.download = fileName;
            link.click();
        }

        // const downloadData = [
        //     { id: 'farmNew', data: farmNew },
        //     { id: 'swordNew', data: swordNew },
        //     { id: 'hswordNew', data: hswordNew },
        //     { id: 'dualwieldNew', data: dualwieldNew },
        //     { id: 'spearNew', data: spearNew },
        //     { id: 'axeNew', data: axeNew },
        //     { id: 'hammerNew', data: hammerNew },
        //     { id: 'staffNew', data: staffNew },
        //     { id: 'shieldNew', data: shieldNew },
        //     { id: 'headNew', data: headNew },
        //     { id: 'shoeNew', data: shoeNew },
        //     { id: 'accNew', data: accNew },
        //     { id: 'colNew', data: colNew },
        //     { id: 'drugRCNew', data: drugRCNew },
        // ]

        const btn = document.querySelectorAll('.btn').forEach(el => {
            el.addEventListener('click', function () {
                downloadFile(downloadData.find(el => el.id == this.value).data, this.dataset.name);
            })
        })
    </script>

</body>

</html>